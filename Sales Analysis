--Changing Date format--

ALTER TABLE sales_data.dbo.sales
ALTER COLUMN orderdate DATE;


--Adding AMER as a Territory for USA and Canada--

SELECT * 
FROM sales_data.dbo.sales
WHERE TERRITORY='NA'

UPDATE Sales_Data.DBO.Sales
SET TERRITORY= 'AMER'
WHERE COUNTRY IN ('USA', 'Canada');


--Total revenue by product line--

SELECT PRODUCTLINE, SUM(QUANTITYORDERED) AS 'QUANTITIES_SOLD',SUM(SALES) AS 'REVENUE' 
FROM Sales_Data.dbo.Sales
GROUP BY PRODUCTLINE
ORDER BY REVENUE DESC;


--Top 5 customers who cancelled most amount of orders--

SELECT top 5 CUSTOMERNAME, SUM(QUANTITYORDERED) AS 'TOTAL QUANTITY', SUM(SALES) AS 'TOTAL PO VALUE' 
FROM Sales_Data.dbo.Sales
WHERE status= 'cancelled'
GROUP BY CUSTOMERNAME
ORDER BY [TOTAL PO VALUE] DESC;


-- Top 5 countries by revenue--

SELECT TOP 5 COUNTRY, SUM(QUANTITYORDERED) AS 'NO OF ORDERS',SUM(SALES) AS 'REVENUE' 
FROM Sales_Data.dbo.Sales
GROUP BY COUNTRY
ORDER BY REVENUE DESC;


--Top 3 Customers with most repeated orders --

SELECT TOP 3 CUSTOMERNAME, COUNT(CUSTOMERNAME) AS 'REPEATS', SUM(SALES) AS 'REVENUE' 
FROM Sales_Data.dbo.Sales
GROUP BY CUSTOMERNAME 
ORDER BY REPEATS DESC;


--Best month for sales each year--

WITH TT AS (
SELECT MONTH_ID, YEAR_ID, COUNT(ORDERNUMBER) AS 'NO_OF_ORDERS' ,SUM(SALES) AS 'REVENUE', ROW_NUMBER() OVER(PARTITION BY YEAR_ID ORDER BY SUM(SALES) DESC) AS 'RANK' 
FROM Sales_Data.dbo.Sales
GROUP BY MONTH_ID, YEAR_ID
)
SELECT CONCAT(TT.MONTH_ID, '/', TT.YEAR_ID) AS 'MONTH', TT.NO_OF_ORDERS, TT.REVENUE FROM TT
WHERE TT.RANK= 1;


--Top customer from each Country--

WITH TT AS (
SELECT COUNTRY, CUSTOMERNAME , SUM(SALES) AS 'REVENUE', ROW_NUMBER() OVER(PARTITION BY COUNTRY ORDER BY SUM(SALES) DESC) AS 'PART' 
FROM Sales_Data.dbo.Sales
GROUP BY COUNTRY, CUSTOMERNAME
)
SELECT TOP 5 TT.COUNTRY, TT.CUSTOMERNAME, TT.REVENUE FROM TT
WHERE PART=1
ORDER BY TT.REVENUE DESC;


--Most sold productline by dealsize--

WITH TT AS  (
SELECT PRODUCTLINE, DEALSIZE, count(PRODUCTLINE) AS 'NO OF PRODUCTS', ROW_NUMBER() OVER(PARTITION BY DEALSIZE ORDER BY COUNT(PRODUCTLINE) DESC) AS 'DEAL_RANK' 
FROM Sales_Data.dbo.Sales
GROUP BY PRODUCTLINE, DEALSIZE
)
SELECT TT.PRODUCTLINE, TT.DEALSIZE, TT.[NO OF PRODUCTS], TT.DEAL_RANK FROM TT
WHERE TT.DEAL_RANK IN ('1','2','3');
